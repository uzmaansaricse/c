<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Books</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .original-price {
            font-size: 14px;
            color: #8b0000;
            text-decoration: line-through;
            margin-right: 8px;
        }
        
        .offer-price {
            font-size: 20px;
            font-weight: bold;
            color: #28a745;
        }
        
        .book-price {
            margin: 8px 0;
            font-weight: 600;
        }
    </style>
   
</head>
<body>

    <div class="top-header d-flex justify-content-center align-items-center">

       <a href="index.html"> <img src="img/Aravli-final-logo.jpg" alt=" Logo"></a>
        <div class="heading">

            <h5 class="mb-0">Aravali Publication</h5>
        </div>
        <div class="qrcode"><a href="QrCodeScan.html"><img src="./img/scanning-qr-code-removebg-preview.png" alt=""></a></div>
    </div>
 <!-- Navbar Start -->
<!-- ‚úÖ NAVBAR -->
<div class="col-sm-12 navbar">
  <div class="menu-toggle">
    <i class="fas fa-bars"></i>
  </div>

  <div class="col-sm-6 nav-items">
    <ul>
        
      
       <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
      <li class="nav-item">
        <i class="fa-solid fa-book-open"></i> Books
        <ul class="dropdown">
          <li><a href="newBookAdd.html">New Book</a></li>
          <li><a href="oldBookAdd.html">Old Book</a></li>
        </ul>
      </li>

      <li><a href="contact-us.html"><i class="fas fa-envelope"></i> Contact Us</a></li>
      <li><a href="FAQ.html"><i class="fas fa-question-circle"></i> FAQs</a></li>
      <li><a href="terms&conditions.html"><i class="fas fa-file-contract"></i> Terms & Conditions</a></li>
      <li><a href="Return-policy.html"><i class="fas fa-undo"></i> Return Policy</a></li>
      <li><a href="shipping-info.html"><i class="fas fa-shipping-fast"></i> Shipping Info</a></li>
      <li><a href="privacy-policy.html"><i class="fas fa-user-secret"></i> Privacy Policy</a></li>
    </ul>
  </div>

  <div class="col-sm-3 contactsupport">
    <!-- üîê SIGNUP BUTTON (shown when not logged in) -->
    <a href="signup-login.html" id="signup-section" style="display: block;">
      <button class="SignUp">
        <i class="fas fa-user-plus"></i>
      </button>
    </a>

    <!-- ‚úÖ PROFILE DROPDOWN (shown when logged in) -->
    <li class="nav-item profile-dropdown-container" id="profile-dropdown-section" style="display: none;">
      <a href="#" class="nav-link profile-dropdown-toggle">
        <i class="fas fa-user-circle profile-icon"></i>
        <span class="profile-username">Profile/Orders</span>
      </a>
      <ul class="dropdown-menu profile-dropdown-menu">
        <li><a href="My profile.html">My Profile</a></li>
        <li><a href="UserStatusOrderMobleNumber.html">Orders</a></li>
        <li><a href="Raiseissue.html">Raise an Issue</a></li>
        <li><a href="Logout.html" onclick="logoutUser()">Logout</a></li>
      </ul>
    </li>
    <a href="Cart Page with Checkout.html">
      <button class="Cart">
        <i class="fas fa-shopping-cart"></i>
        <sup id="cart-count">0</sup>
      </button>
    </a>

    <a href="QrCodeScan.html">
      <button class="Scanner">
        <i class="fa fa-qrcode"></i>
      </button>
    </a>

    <!-- <a href="Search book.html">
      <button class="Search">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
    </a> -->
  </div>
</div>

<!-- ‚úÖ JS SCRIPT -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
  const token = localStorage.getItem("token"); // Use the same key as in signup-login.html


    const signupSection = document.getElementById("signup-section");
    const profileDropdown = document.getElementById("profile-dropdown-section");

    // Show/hide sections based on login status
    if (token) {
      if (signupSection) signupSection.style.display = "none";
      if (profileDropdown) profileDropdown.style.display = "block";
    } else {
      if (signupSection) signupSection.style.display = "block";
      if (profileDropdown) profileDropdown.style.display = "none";
    }
  });

  function logoutUser() {
    localStorage.removeItem("token");
    location.reload();
  }
</script>


    <main>
        <section id="newBooksContainer" class="books-grid">
            <!-- New books will be displayed here -->
        </section>
    </main>


    <footer class="footer">
        <div class="footer-container">
            <!-- Section 1: Logo & About -->
            <div class="footer-section">
                <img alt="Bookstore Logo - A stylized open book with pages turning" class="footer-logo" height="150"
                    src="img/Aravli-final-logo.jpg" width="150" />

            </div>
            <!-- Section 2: Quick Links -->
            <div class="footer-section">
                <h3>
                    Quick Links
                </h3>
                <ul class="footer-anchor">
                    <li>
                        <i class="fas fa-home">
                        </i>
                        <a href="./index.html">
                            Home
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-th-list">
                        </i>
                        <a href="AllBookShow.html">
                            All Books
                        </a>
                    </li>


                    <li>
                        <i class="fas fa-envelope">
                        </i>
                        <a href="contact-us.html">
                            Contact Us
                        </a>
                    </li>
                </ul>
            </div>
            <!-- Section 3: Customer Support -->
            <div class="footer-section">
                <h3>
                    Customer Support
                </h3>
                <ul class="footer-anchor">
                    <li>
                        <i class="fas fa-question-circle">
                        </i>
                        <a href="./FAQ.html">
                            FAQs
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-undo">
                        </i>
                        <a href="./Return-policy.html">
                            Return Policy
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-shipping-fast">
                        </i>
                        <a href="./shipping-info.html">
                            Shipping Info
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-user-secret">
                        </i>
                        <a href="./privacy-policy.html">
                            Privacy Policy
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-file-contract">
                        </i>
                        <a href="./terms&conditions.html">
                            Terms &amp; Conditions
                        </a>
                    </li>
                </ul>
            </div>

            <!-- section Contact Us -->
            <div class="footer-section">
                <div class="Contact-US">
                    <h3>Contact-US</h3>
                    <a href="tel:9351324018">
                        <p><img class="telephone" src="./images/telephone_724664.png" alt="">9351324018</p>
                    </a>
                    <a href="tel:9351324018">
                        <p><img class="telephone" src="./images/telephone_724664.png" alt="">9351324018</p>
                    </a>
                    <p><i class="fa fa-location"></i> <b>Address:</b>&nbsp; Plot No. 17-A, Balaji Vihar 14-A, Loha Mandi Road, Sikar Road, Jaipur, 302013
                       
                        </p>
                </div>
            </div>
            <!-- Section 4: Social Media -->
            <div class="Social-Media">
                <h3>
                    Follow Us
                </h3>
                <div class="social-icons">
                    <a href="https://www.facebook.com/share/15TCANusow/" target="_blank">
                        <i class="fab fa-facebook fa-2x">
                        </i>
                    </a>
                    <a href="https://t.me/aravalipublication" target="_blank">
                        <i class="fa-brands fa-telegram fa-2x"></i>
                    </a>
                    <a href="https://www.instagram.com/prahladramyadav?igsh=emM0emJocmg0Yncx " target="_blank">
                        <i class="fab fa-instagram fa-2x">
                        </i>
                    </a>
                    <a href="https://wa.me/9351324018" target="_blank"> <i class="fa-brands fa-whatsapp fa-2x"></i>
                    </a>

                </div>
                <p class="mt-4">
                    Stay connected with us.
                </p>
            </div>



        </div>
        <!-- Copyright Section -->
        <div class="footer-bottom">
            <p>
                ¬© 2025 NEWAravali Publisher And Distributors LLP | All Rights Reserved | Designed & Developed by <a
                    href="https://www.techbro24.com/" target="_blank"> TechBro24</a>
                <hr>
            </p>
        </div>
    </footer>

  <script>
    async function fetchNewBooks() {
      try {
        const response = await fetch('/api/getNewBooks');
        const data = await response.json();
        console.log("Fetched Books:", data);

        const container = document.getElementById("newBooksContainer");
        container.innerHTML = "";

        data.books.forEach(book => {
          if (!book || !book._id || !book.title) return;

          console.log("Book price:", book.price, "Type:", typeof book.price);
          console.log("Book offerPrice:", book.offerPrice, "Type:", typeof book.offerPrice);

          const card = document.createElement("div");
          card.classList.add("book-card");

          card.innerHTML = `
            <img class="book-image" src="${book.bookImage || 'default.jpg'}" alt="${book.title}">
            <div class="rating-overlay">
              ${generateStars(book.averageRating)}
              <span class="avg-text">(${book.averageRating || 0} ‚≠ê)</span>
            </div>
            <div class="book-title">${book.title}</div>
            <div class="book-author">by ${book.author || 'Unknown'}</div>
            <div class="book-price">
              ${
                (book.offerPrice && book.offerPrice < book.price)
                  ? `<span class="original-price" style="text-decoration: line-through;">‚Çπ${book.price}</span> <span class="offer-price">‚Çπ${book.offerPrice}</span>`
                  : `<span class="original-price">‚Çπ${book.price || 0}</span>`
              }
            </div>
            <button class="add-cart">Add to Cart</button>
            <button class="go-cart" style="display: none;">Go to Cart</button>
          `;

          card.querySelector(".book-image").addEventListener("click", () => {
            window.location.href = `/newbookDetelies.html?id=${book._id}`;
          });

          const addBtn = card.querySelector(".add-cart");
          const goBtn = card.querySelector(".go-cart");

          addBtn.addEventListener("click", e => {
            e.stopPropagation();
            addToCart(book._id, book.title, book.bookImage, book.offerPrice || book.price);
            Swal.fire({
              icon: 'success',
              title: 'Book Added!',
              text: `"${book.title}" has been added to your cart.`,
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 2000,
              timerProgressBar: true
            });
            addBtn.style.display = "none";
            goBtn.style.display = "inline-block";
          });

          goBtn.addEventListener("click", e => {
            e.stopPropagation();
            window.location.href = "Cart Page with Checkout.html";
          });

          container.appendChild(card);
        });

      } catch (err) {
        console.error("Error fetching books:", err);
      }
    }

    function generateStars(rating) {
      rating = parseFloat(rating) || 0;
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) stars += `<i class="fas fa-star" style="color: gold;"></i>`;
        else if (i - rating < 1) stars += `<i class="fas fa-star-half-alt" style="color: gold;"></i>`;
        else stars += `<i class="far fa-star" style="color: gold;"></i>`;
      }
      return stars;
    }

    function addToCart(id, title, image, price) {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(item => item.id === id);
      if (existing) existing.quantity += 1;
      else cart.push({ id, title, image, price, quantity: 1 });
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartNotification();
    }

    function updateCartNotification() {
      const badge = document.getElementById("cart-count");
      if (!badge) return;
      const items = JSON.parse(localStorage.getItem("cart")) || [];
      const total = items.reduce((sum, itm) => sum + itm.quantity, 0);
      badge.textContent = total;
      badge.style.display = total === 0 ? "none" : "inline-block";
    }

    window.addEventListener("DOMContentLoaded", () => {
      fetchNewBooks();
      updateCartNotification();
    });
  </script>
  <script src="script.js"></script>
</body>
</html>
