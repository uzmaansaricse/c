<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Old Books</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .original-price {
            font-size: 14px;
            color: #8b0000;
            text-decoration: line-through;
            margin-right: 8px;
        }
        
        .offer-price {
            font-size: 20px;
            font-weight: bold;
            color: #28a745;
        }
        
        .book-price {
            margin: 8px 0;
            font-weight: 600;
        }
    </style>
    
   
</head>
<body>

    <div class="top-header d-flex justify-content-center align-items-center">

       <a href="index.html"> <img src="img/Aravli-final-logo.jpg" alt=" Logo"></a>
        <div class="heading">

            <h5 class="mb-0">Aravali Publication</h5>
        </div>
        <div class="qrcode"><a href="QrCodeScan.html"><img src="./img/scanning-qr-code-removebg-preview.png" alt=""></a></div>
    </div>
 <!-- Navbar Start -->
<!-- ‚úÖ NAVBAR -->
<div class="col-sm-12 navbar">
  <div class="menu-toggle">
    <i class="fas fa-bars"></i>
  </div>

  <div class="col-sm-6 nav-items">
    <ul>
        
      
       <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
      <li class="nav-item">
        <i class="fa-solid fa-book-open"></i> Books
        <ul class="dropdown">
          <li><a href="AllBookShow.html">All Book</a></li>
          <li><a href="newBookAdd.html">New Book</a></li>
          <li><a href="oldBookAdd.html">Old Book</a></li>
        </ul>
      </li>

      <li><a href="contact-us.html"><i class="fas fa-envelope"></i> Contact Us</a></li>
      <li><a href="FAQ.html"><i class="fas fa-question-circle"></i> FAQs</a></li>
      <li><a href="terms&conditions.html"><i class="fas fa-file-contract"></i> Terms & Conditions</a></li>
      <li><a href="Return-policy.html"><i class="fas fa-undo"></i> Return Policy</a></li>
      <li><a href="shipping-info.html"><i class="fas fa-shipping-fast"></i> Shipping Info</a></li>
      <li><a href="privacy-policy.html"><i class="fas fa-user-secret"></i> Privacy Policy</a></li>
    </ul>
  </div>

  <div class="col-sm-3 contactsupport">
    <!-- üîê SIGNUP BUTTON (shown when not logged in) -->
    <a href="signup-login.html" id="signup-section" style="display: block;">
      <button class="SignUp">
        <i class="fas fa-user-plus"></i>
      </button>
    </a>

    <!-- ‚úÖ PROFILE DROPDOWN (shown when logged in) -->
    <li class="nav-item profile-dropdown-container" id="profile-dropdown-section" style="display: none;">
      <a href="#" class="nav-link profile-dropdown-toggle">
        <i class="fas fa-user-circle profile-icon"></i>
        <span class="profile-username">Profile</span>
      </a>
      <ul class="dropdown-menu profile-dropdown-menu">
        <li><a href="My profile.html">My Profile</a></li>
        <li><a href="UserStatusOrderMobleNumber.html">Orders</a></li>
        <li><a href="Raiseissue.html">Raise an Issue</a></li>
        <li><a href="Logout.html" onclick="logoutUser()">Logout</a></li>
      </ul>
    </li>
    <a href="Cart Page with Checkout.html">
      <button class="Cart">
        <i class="fas fa-shopping-cart"></i>
        <sup id="cart-count">0</sup>
      </button>
    </a>

    <a href="QrCodeScan.html">
      <button class="Scanner">
        <i class="fa fa-qrcode"></i>
      </button>
    </a>

    <!-- <a href="Search book.html">
      <button class="Search">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
    </a> -->
  </div>
</div>

<!-- ‚úÖ JS SCRIPT -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
  const token = localStorage.getItem("token"); // Use the same key as in signup-login.html


    const signupSection = document.getElementById("signup-section");
    const profileDropdown = document.getElementById("profile-dropdown-section");

    // Show/hide sections based on login status
    if (token) {
      if (signupSection) signupSection.style.display = "none";
      if (profileDropdown) profileDropdown.style.display = "block";
    } else {
      if (signupSection) signupSection.style.display = "block";
      if (profileDropdown) profileDropdown.style.display = "none";
    }
  });

  function logoutUser() {
    localStorage.removeItem("token");
    location.reload();
  }
</script>



    <main>
        <section id="oldBooksContainer" class="books-grid">
            <!-- Old books will be displayed here -->
        </section>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <!-- Section 1: Logo & About -->
            <div class="footer-section">
                <img alt="Bookstore Logo - A stylized open book with pages turning" class="footer-logo" height="150"
                    src="img/Aravli-final-logo.jpg" width="150" />

            </div>
            <!-- Section 2: Quick Links -->
            <div class="footer-section">
                <h3>
                    Quick Links
                </h3>
                <ul class="footer-anchor">
                    <li>
                        <i class="fas fa-home">
                        </i>
                        <a href="./index.html">
                            Home
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-th-list">
                        </i>
                        <a href="AllBookShow.html">
                            All Books
                        </a>
                    </li>


                    <li>
                        <i class="fas fa-envelope">
                        </i>
                        <a href="contact-us.html">
                            Contact Us
                        </a>
                    </li>
                </ul>
            </div>
            <!-- Section 3: Customer Support -->
            <div class="footer-section">
                <h3>
                    Customer Support
                </h3>
                <ul class="footer-anchor">
                    <li>
                        <i class="fas fa-question-circle">
                        </i>
                        <a href="./FAQ.html">
                            FAQs
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-undo">
                        </i>
                        <a href="./Return-policy.html">
                            Return Policy
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-shipping-fast">
                        </i>
                        <a href="./shipping-info.html">
                            Shipping Info
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-user-secret">
                        </i>
                        <a href="./privacy-policy.html">
                            Privacy Policy
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-file-contract">
                        </i>
                        <a href="./terms&conditions.html">
                            Terms &amp; Conditions
                        </a>
                    </li>
                </ul>
            </div>

            <!-- section Contact Us -->
            <div class="footer-section">
                <div class="Contact-US">
                    <h3>Contact-US</h3>
                    <a href="tel:+919358087121">
                        <p><img class="telephone" src="./images/telephone_724664.png" alt="">+919358087121</p>
                    </a>
                    <a href="tel:+919982934869">
                        <p><img class="telephone" src="./images/telephone_724664.png" alt="">+919982934869</p>
                    </a>
                    <p><i class="fa fa-location"></i> <b>Address:</b>&nbsp; Plot number 1, Rajeev Nagar, Vidhyadhar
                        Nagar
                        Sector 3, Jaipur 302038</p>
                </div>
            </div>
            <!-- Section 4: Social Media -->
            <div class="Social-Media">
                <h3>
                    Follow Us
                </h3>
                <div class="social-icons">
                    <a href="https://www.facebook.com/share/15TCANusow/" target="_blank">
                        <i class="fab fa-facebook fa-2x">
                        </i>
                    </a>
                    <a href="https://t.me/aravalipublication" target="_blank">
                        <i class="fa-brands fa-telegram fa-2x"></i>
                    </a>
                    <a href="https://www.instagram.com/prahladramyadav?igsh=emM0emJocmg0Yncx " target="_blank">
                        <i class="fab fa-instagram fa-2x">
                        </i>
                    </a>
                    <a href="https://wa.me/+919358087121" target="_blank"> <i class="fa-brands fa-whatsapp fa-2x"></i>
                    </a>

                </div>
                <p class="mt-4">
                    Stay connected with us.
                </p>
            </div>



        </div>
        <!-- Copyright Section -->
        <div class="footer-bottom">
            <p>
                ¬© 2025 NEWAravali Publisher And Distributors LLP | All Rights Reserved | Designed & Developed by <a
                    href="https://www.techbro24.com/" target="_blank"> TechBro24</a>
                <hr>
            </p>
        </div>
    </footer>
   <script>
        document.addEventListener("DOMContentLoaded", function () {
            const menuToggle = document.querySelector(".menu-toggle");
            const navItems = document.querySelector(".nav-items");
            menuToggle.addEventListener("click", function () {
                navItems.classList.toggle("actives");
            });
        });
// üìò Old Arrivals
async function fetchOldBooks() {
    try {
        const response = await fetch('/api/old-book');  
        const data = await response.json();
        console.log("Fetched Books:", data);

        const oldBooksContainer = document.getElementById("oldBooksContainer");
        oldBooksContainer.innerHTML = "";

        // Check if there are no old books
        if (!data.books || data.books.length === 0) {
            oldBooksContainer.innerHTML = `
                <div style="text-align: center; padding: 50px; color: #666;">
                    <i class="fas fa-book" style="font-size: 48px; margin-bottom: 20px;"></i>
                    <h3>No Old Books Available</h3>
                    <p>We currently don't have any old books in stock. Please check back later!</p>
                </div>
            `;
            return;
        }

        data.books.forEach(book => {
            if (!book || !book._id || !book.title) {
                console.warn("Skipping invalid book:", book);
                return;
            }

            const bookCard = document.createElement("div");
            bookCard.classList.add("book-card");

            bookCard.innerHTML = `
                <img class="book-image" src="${book.bookImage || 'default.jpg'}" alt="${book.title}">
                <div class="rating-overlay">
                    ${generateStars(book.averageRating)}
                    <span class="avg-text">(${book.averageRating || 0} ‚≠ê)</span>
                </div>
                <div class="book-title">${book.title}</div>
                <div class="book-author">by ${book.author || 'Unknown'}</div>
                <div class="book-price">
                    ${
                        book.offerPrice && book.offerPrice < book.price
                        ? `<span class="original-price" style="text-decoration: line-through;">‚Çπ${book.price}</span> <span class="offer-price">‚Çπ${book.offerPrice}</span>`
                        : `‚Çπ${book.price}`
                    }
                </div>
                <button class="add-cart">Add to Cart</button>
                <button class="go-cart" style="display: none;">Go to Cart</button>
            `;

            bookCard.querySelector(".book-image").addEventListener("click", () => {
                window.location.href = `/newbookDetelies.html?id=${book._id}`;
            });

            const addCartBtn = bookCard.querySelector(".add-cart");
            const goCartBtn = bookCard.querySelector(".go-cart");

            addCartBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                addToCart(book._id, book.title, book.bookImage, book.offerPrice || book.price);

                Swal.fire({
                    icon: 'success',
                    title: 'Added to Cart',
                    text: `"${book.title}" has been added to your cart.`,
                    showConfirmButton: false,
                    timer: 1500
                });

                addCartBtn.style.display = "none";
                goCartBtn.style.display = "inline-block";
            });

            goCartBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                window.location.href = "Cart Page with Checkout.html";
            });

            oldBooksContainer.appendChild(bookCard);
        });

    } catch (err) {
        console.error("Error fetching old books:", err);
        Swal.fire({
            icon: 'error',
            title: 'Oops!',
            text: 'Failed to load old books.',
        });
    }
}

function generateStars(rating) {
    rating = parseFloat(rating) || 0;
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
            stars += `<i class="fas fa-star" style="color: gold;"></i>`;
        } else if (i - rating < 1) {
            stars += `<i class="fas fa-star-half-alt" style="color: gold;"></i>`;
        } else {
            stars += `<i class="far fa-star" style="color: gold;"></i>`;
        }
    }
    return stars;
}

function addToCart(id, title, image, price) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let existingItem = cart.find(item => item.id === id);

    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ id, title, image, price, quantity: 1 });
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartNotification();
}

function updateCartNotification() {
    const cartBadge = document.querySelector("sup#cart-count");
    if (!cartBadge) return;
    let cartItems = JSON.parse(localStorage.getItem("cart")) || [];
    const totalQuantity = cartItems.reduce((sum, item) => sum + item.quantity, 0);
    cartBadge.textContent = totalQuantity;
    cartBadge.style.display = totalQuantity === 0 ? "none" : "inline-block";
}

document.addEventListener("DOMContentLoaded", () => {
    fetchOldBooks();
    updateCartNotification();
});
    </script>
    <script src="script.js"></script>
</body>
</html>
